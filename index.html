<!DOCTYPE html>
<html>
<head>
	<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
	<title>Stats</title>
</head>
<body>
 
<div id='container1'>
	<p id='countTitle'></p>
	<canvas id='graph'></canvas>

</div>

</body>

<script type="text/javascript">

	function HexToRGB(hex_color,trnsprnc){
		var myRegexp = /#+([a-zA-Z0-9]{2})+([a-zA-Z0-9]{2})+([a-zA-Z0-9]{2})/gm;
		  var m = myRegexp.exec(hex_color);
		  var r = parseInt(m[1],16);
		  var g = parseInt(m[2],16);
		  var b = parseInt(m[3],16);
		  return( "rgb("+r+","+ g+","+b+","+trnsprnc+")")
	}

	var xhr = new XMLHttpRequest();
	var url = 'https://greasyfork.org/fr/scripts/418188-youtube-playlist-total-duration/stats.json'; 
	xhr.responseType = "json";
	
	xhr.open('GET', url);
		       
	xhr.onload = function(){ 
		var response = xhr.response ;

		var c = 0 ;
		var date_array = []
		var download_array = []
		var check_array = []


		while (true) {
			
			var d = new Date();
			d.setDate(d.getDate() - c);
			var dd = String(d.getDate()).padStart(2, '0');
			var mm = String(d.getMonth() + 1).padStart(2, '0'); //January is 0!
			var yyyy = d.getFullYear();
			today = yyyy + '-' + mm + '-' + dd ;

			if (response[today] == undefined){ break; }else {c++;}
		
			date_array.push(today)
			download_array.push(response[today]['installs'])
			check_array.push(response[today]['update_checks'])
			
			

		}
		const cumulativeSum = (sum => value => sum += value)(0);
		download_array_cumul =download_array.map(cumulativeSum);
		data = {'labels': date_array, 'values':download_array_cumul}
		var c = createChart('graph',data)
		var total = download_array_cumul[download_array_cumul.length-1]
        var title = document.getElementById('countTitle');
        title.innerHTML = `Downloads :  ${total}`

 	}
 	xhr.send();

 	function createChart(canva_name,data){

        var ctx = document.getElementById(canva_name);
        var color = '#4287f5'

        var myLineChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: data['labels'],
            datasets: [
                {
                    label: "Total Downloads",
                    data: data['values'],
                    lineTension: 0.4,
                    backgroundColor: HexToRGB(color,0.1), //Area
                    borderColor: color, //line
                    borderWidth: 2,
                    pointRadius: 3.5,
                    pointBackgroundColor: 'white', //Point
                    pointBorderColor: color,
                    pointHoverRadius: 4,
                    pointHoverBackgroundColor: color,
                    pointHoverBorderColor: color,
                    pointHitRadius: 15,
                },
                
            ]

        },
        options: {

            scales: {
                    xAxes: [
                      {
                        time: {
                          unit: "date",
                        },
                        gridLines: {
                          display: false,
                          drawBorder: false,
                        },
                        ticks: {maxRotation: 0,
                                minRotation: 0,
                                maxTicksLimit: 5,
                                padding: 1,
                        },
                       
                      },
                    ],
                  yAxes: [{
                    ticks: {
                      maxTicksLimit: 15,
                      padding: 1,
                      
                    },
                    gridLines: {
                      color: "rgb(234, 236, 244)",
                      zeroLineColor: "rgb(234, 236, 244)",
                      drawBorder: false,
                }
              }],
             },

            legend: {
                display: false,
                onClick: function(event, legendItem) {},
                position: 'bottom'
             },

            tooltips: {
                backgroundColor: "rgb(255,255,255)",
                bodyFontColor: "#858796",
                titleMarginBottom: 10,
                titleFontColor: "#6e707e",
                titleFontSize: 14,
                borderColor: "#dddfeb",
                borderWidth: 0.7,
                xPadding: 15,
                yPadding: 15,
                displayColors: false,
                intersect: false,
                mode: "index",
                caretPadding: 10,
            },
        }
        });

       
    }

</script>

<style type="text/css">
@import url('https://fonts.googleapis.com/css2?family=Open+Sans:wght@700&display=swap');
	
body{
	background: white;
}

#container1{
	display: flex;
    flex-direction: column;
    justify-content: center;	
    margin-top: 3em;
	margin-right: 45em;
	margin-left: 45em;
	
	padding: 5em;
	border-radius: 20px;
	background: white;
	box-shadow:  10px 10px 30px #adadad,
             -10px -10px 30px #ebebeb;

}

#countTitle{
	
	font-family: 'Open Sans', sans-serif;
	font-size: 24px; 
	font-style: normal; 
	font-variant: normal; 
	font-weight: 700; 
	line-height: 26.4px; 
	color: #515357;
	margin-bottom: 1em;
	margin-left: 1em;
}


</style>
</html>